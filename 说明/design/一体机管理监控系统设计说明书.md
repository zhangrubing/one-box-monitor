# 一体机管理监控系统设计说明书（v1.0）

> 适配“英智·智算云 / GPU 云租赁平台”一体机（含 8×GPU 4090/H100/H200/B200、裸金属、GPU 集群节点）

---

## 1. 目标与范围

**目标**：为部署在客户现场或机房中的“算力一体机”提供统一的资产管理、可观测性监控、告警联动、远程运维与合规审计能力，兼容离线/半离线环境与多租户隔离。

**适用范围**：单台一体机、机柜级（多台）、小规模集群（≤128 节点）的混合场景；兼容 Linux（Ubuntu 20.04/22.04/24.04）、BMC（IPMI/Redfish）、NVIDIA GPU（4090/H100/H200/B200/H20/L40S 等）、IB/RoCE 网络、Ceph/Lustre/NFS 存储。

**不在范围**：大规模（>500 节点）跨地域调度、超分布式日志检索（可通过对接外部平台实现）。

---

## 2. 用户画像与典型场景

- **平台运维（SRE/DevOps）**：批量纳管、固件与驱动基线检查、快速定位硬件/网络故障。
- **租户管理员**：查看仅授权资源的性能、配额、账单相关指标（与业务平台联动）。
- **售后/交付工程师**：开箱验收、上电巡检、交付报告自动生成、远程诊断与换件工单。
- **安全/合规**：审计操作、变更留痕、策略合规（密码策略、端口暴露、补丁状态）。

---

## 3. 功能需求

### 3.1 资产与生命周期

- 设备登记/自动发现（带外：BMC 扫描；带内：Agent 自注册）；
- 硬件指纹：主板型号、BIOS、BMC、CPU、内存/插槽、PCIe 拓扑、GPU/NVSwitch、NIC（IB/RoCE/以太）、磁盘/RAID；
- 固件与驱动基线校验；
- 生命周期：入库→上电巡检→在保/在役→故障/维修→退役/销毁；交付与验收报告生成。

### 3.2 监控与可观测性

- 主机：CPU、内存、磁盘、IOPS、SMART、RAID 阵列状态；
- GPU：温度、功耗、显存、利用率、ECC 错误、NVLink/NVSwitch 计数、MIG/vGPU 状态；
- 网络：IB/RoCE 指标（链路状态、丢包、延迟、PFC、ECN）；
- 存储：Ceph/Lustre/NFS 健康、IO 延迟、容量；
- 电源与环境：PSU/FAN/温湿度；
- 系统日志：结构化采集与索引。

### 3.3 告警与事件

- 阈值告警、相关性告警、租户/业务 SLO 告警；
- 告警路由、抑制、升级闭环（工单/IM/短信/邮件）。

### 3.4 远程运维

- 带外：IPMI/Redfish 电源、KVM Console；
- 带内：SSH/Ansible 作业、固件与驱动升级、配置合规；
- 升级策略：滚动升级、A/B 回滚。

### 3.5 多租户与权限

- 三层模型：组织/项目/租户，RBAC 权限；
- 数据隔离与脱敏；
- 审计日志与 SSO。

### 3.6 报表与对外接口

- 交付巡检报告、SLA 月报、容量/能效报告；
- Webhook/消息总线推送；
- 对接“英智·算力服务平台”。

---

## 4. 技术架构

- Edge Agent（采集器）；
- 控制平面 API（FastAPI）；
- Prometheus/VictoriaMetrics（指标存储）；
- Loki/Elastic（日志存储）；
- Alertmanager（告警）。

---

## 5. 数据模型

- 资产表、组件表、固件基线表、指标索引表、告警事件表、巡检报告表。

---

## 6. API 设计

- `POST /v1/agent/register`：注册；
- `POST /v1/metrics/push`：指标上传；
- `GET /v1/assets/{node_id}`：资产详情；
- `POST /v1/reports/inspection`：巡检报告生成。

---

## 7. 仪表盘与告警矩阵

- 总览、GPU 面板、网络面板、存储面板、环境面板、租户视角；
- 告警示例：GPU 过温、ECC 错误、IB flap、磁盘 SMART 异常、PSU/FAN 失效。

---

## 8. 安装与交付

- PXE/ISO 部署、一键脚本安装；
- 上电巡检自动报告；
- 工单联动与责任边界。

---

## 9. 安全与合规

- 口令策略、BMC 访问控制、证书管理、日志保留；
- SLA 与合同边界。

---

## 10. 高可用与容量规划

- 控制面多副本、指标降采样、归档存储；
- 节点指标估算与存储需求。

---

## 11. 可运维性

- 常见告警 Runbook；
- 故障复盘。

---

## 12. 里程碑

- M1：PoC；
- M2：标准版；

---
